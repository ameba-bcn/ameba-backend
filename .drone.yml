---


kind: pipeline
name: default


steps:
- name: test
  image: docker:dind
  volumes:
  - name: dockersock
    path: /var/run
  commands:
  - sleep 5 # give docker enough time to start
  - docker-compose build ameba-backend
  - if [ $DRONE_BRANCH == *dev ]; then
      docker tag ameba-backend drone:5000/ameba-backend:dev;
      docker push ameba-backend drone:5000/ameba-backend:dev;
    fi;

services:
- name: docker
  image: docker:dind
  privileged: true
  volumes:
  - name: dockersock
    path: /var/run


volumes:
- name: dockersock
  temp: {}